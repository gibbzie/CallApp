import{f as e}from"./vendor.519c7c38.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,c)=>{const d=new URL(e,n);if(self[t].moduleMap[d])return a(self[t].moduleMap[d]);const s=new Blob([`import * as m from '${d}';`,`${t}.moduleMap['${d}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){c(new Error(`Failed to import: ${e}`)),o(i)},onload(){a(self[t].moduleMap[d]),o(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/CallApp/assets/");const t={apiKey:"AIzaSyA37ovhknkdl4Z3ZncLZ9S487IcYe_5xrQ",authDomain:"callapp-6e504.firebaseapp.com",projectId:"callapp-6e504",storageBucket:"callapp-6e504.appspot.com",messagingSenderId:"158283261786",appId:"1:158283261786:web:860a5937f7f509982d7563"};e.apps.length||e.initializeApp(t);const a=e.firestore(),n=new RTCPeerConnection({iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10});let o=null,c=null;const d=document.getElementById("webcamButton"),s=document.getElementById("webcamVideo"),i=document.getElementById("callButton"),l=document.getElementById("callInput"),r=document.getElementById("shareScreenButton");document.getElementById("screenVideo");const p=document.getElementById("answerButton"),m=document.getElementById("remoteVideo"),u=document.getElementById("hangupButton");let f=[];d.onclick=async()=>{o=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),c=new MediaStream,o.getTracks().forEach((e=>{f.push(e),n.addTrack(e,o)})),n.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{c.addTrack(e)}))},s.srcObject=o,m.srcObject=c,i.disabled=!1,p.disabled=!1,d.disabled=!0,s.muted=!0},i.onclick=async()=>{p.disabled=!0;const e=a.collection("calls").doc(),t=e.collection("offerCandidates"),o=e.collection("answerCandidates");l.value=e.id,n.onicecandidate=e=>{e.candidate&&t.add(e.candidate.toJSON())};const c=await n.createOffer();await n.setLocalDescription(c);const d={sdp:c.sdp,type:c.type};await e.set({offer:d}),e.onSnapshot((e=>{const t=e.data();if(!n.currentRemoteDescription&&(null==t?void 0:t.answer)){const e=new RTCSessionDescription(t.answer);n.setRemoteDescription(e)}})),o.onSnapshot((e=>{e.docChanges().forEach((e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());n.addIceCandidate(t)}}))})),u.disabled=!1,r.disabled=!1,m.controls=!0},p.onclick=async()=>{const e=l.value,t=a.collection("calls").doc(e),o=t.collection("answerCandidates"),c=t.collection("offerCandidates");n.onicecandidate=e=>{e.candidate&&o.add(e.candidate.toJSON())};const d=(await t.get()).data().offer;await n.setRemoteDescription(new RTCSessionDescription(d));const s=await n.createAnswer();await n.setLocalDescription(s);const i={type:s.type,sdp:s.sdp};await t.update({answer:i}),c.onSnapshot((e=>{e.docChanges().forEach((e=>{if(console.log(e),"added"===e.type){let t=e.doc.data();n.addIceCandidate(new RTCIceCandidate(t))}}))})),r.disabled=!1,m.controls=!0};let g=null,w=null;r.onclick=async()=>{g=await navigator.mediaDevices.getDisplayMedia({cursor:!0}),w=g.getTracks()[0],n.getSenders().find((e=>"video"===e.track.kind)).replaceTrack(w),w.onended=()=>{let e=f.find((e=>"video"===e.kind));n.getSenders().find((e=>"video"===e.track.kind)).replaceTrack(e),s.srcObject=o},s.srcObject=g};
